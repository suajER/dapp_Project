{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar cid = require('multiformats/cid');\n\nvar configure = require('./lib/configure.js');\n\nvar toUrlSearchParams = require('./lib/to-url-search-params.js');\n\nvar stat = require('./files/stat.js');\n\nconst createLs = configure.configure((api, opts) => {\n  async function* ls(path, options = {}) {\n    const pathStr = \"\".concat(path instanceof Uint8Array ? cid.CID.decode(path) : path);\n\n    async function mapLink(link) {\n      let hash = link.Hash;\n\n      if (hash.includes('/')) {\n        const ipfsPath = hash.startsWith('/ipfs/') ? hash : \"/ipfs/\".concat(hash);\n        const stats = await stat.createStat(opts)(ipfsPath);\n        hash = stats.cid;\n      } else {\n        hash = cid.CID.parse(hash);\n      }\n\n      const entry = {\n        name: link.Name,\n        path: pathStr + (link.Name ? \"/\".concat(link.Name) : ''),\n        size: link.Size,\n        cid: hash,\n        type: typeOf(link)\n      };\n\n      if (link.Mode) {\n        entry.mode = parseInt(link.Mode, 8);\n      }\n\n      if (link.Mtime !== undefined && link.Mtime !== null) {\n        entry.mtime = {\n          secs: link.Mtime\n        };\n\n        if (link.MtimeNsecs !== undefined && link.MtimeNsecs !== null) {\n          entry.mtime.nsecs = link.MtimeNsecs;\n        }\n      }\n\n      return entry;\n    }\n\n    const res = await api.post('ls', {\n      signal: options.signal,\n      searchParams: toUrlSearchParams.toUrlSearchParams({\n        arg: pathStr,\n        ...options\n      }),\n      headers: options.headers\n    });\n\n    for await (let result of res.ndjson()) {\n      result = result.Objects;\n\n      if (!result) {\n        throw new Error('expected .Objects in results');\n      }\n\n      result = result[0];\n\n      if (!result) {\n        throw new Error('expected one array in results.Objects');\n      }\n\n      const links = result.Links;\n\n      if (!Array.isArray(links)) {\n        throw new Error('expected one array in results.Objects[0].Links');\n      }\n\n      if (!links.length) {\n        yield mapLink(result);\n        return;\n      }\n\n      yield* links.map(mapLink);\n    }\n  }\n\n  return ls;\n});\n\nfunction typeOf(link) {\n  switch (link.Type) {\n    case 1:\n    case 5:\n      return 'dir';\n\n    case 2:\n      return 'file';\n\n    default:\n      return 'file';\n  }\n}\n\nexports.createLs = createLs;","map":null,"metadata":{},"sourceType":"script"}